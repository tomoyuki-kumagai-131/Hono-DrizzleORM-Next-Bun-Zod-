# OAuth クライアント ID の詳細設定ガイド

## 承認済み JavaScript 生成元の設定

「承認済み JavaScript がありません」というエラーは、OAuth クライアント ID に JavaScript 生成元が設定されていないことが原因です。

---

## ステップ 1: 認証情報ページにアクセス

1. [Google Cloud Console](https://console.cloud.google.com/) を開く
2. 上部でプロジェクトが選択されていることを確認
3. 左側のメニュー（☰）をクリック
4. **「API とサービス」** → **「認証情報」** をクリック

---

## ステップ 2: OAuth クライアント ID を探す

「認証情報」ページで以下のセクションがあります:

### OAuth 2.0 クライアント ID セクション

このセクションに、既存の OAuth クライアント ID が表示されます。

**既存のクライアント ID がある場合:**
- 「ウェブ クライアント」や作成時につけた名前が表示されます
- クライアント ID の名前をクリック

**OAuth クライアント ID がまだない場合:**
- 次のステップ 3 に進んで新規作成してください

---

## ステップ 3: OAuth クライアント ID の作成（まだない場合）

### 3-1. 認証情報を作成

1. ページ上部の **「+ 認証情報を作成」** ボタンをクリック
2. ドロップダウンメニューから **「OAuth クライアント ID」** を選択

### 3-2. アプリケーションの種類を選択

**重要: 必ず「ウェブ アプリケーション」を選択してください**

1. 「アプリケーションの種類」で **「ウェブ アプリケーション」** を選択
2. 名前を入力:
   ```
   Twitter Clone Web Client
   ```

### 3-3. 承認済みの JavaScript 生成元を追加 ⭐

「承認済みの JavaScript 生成元」セクションで:

1. **「+ URI を追加」** ボタンをクリック
2. 以下の URI を入力:
   ```
   http://localhost:3000
   ```
3. Enter キーを押すか、外側をクリックして確定

**注意点:**
- `http://` を必ず含める（`https://` ではない）
- 末尾にスラッシュ `/` を付けない
- ポート番号 `:3000` を必ず含める

### 3-4. 承認済みのリダイレクト URI を追加

「承認済みのリダイレクト URI」セクションで:

1. **「+ URI を追加」** ボタンをクリック
2. 以下の URI を入力:
   ```
   http://localhost:3000
   ```

### 3-5. 作成を完了

1. **「作成」** ボタンをクリック
2. ポップアップが表示されたら:
   - **クライアント ID** をコピー（既に設定済みなら不要）
   - **「OK」** をクリック

---

## ステップ 4: 既存のクライアント ID を編集する場合

### 4-1. クライアント ID を開く

1. 「認証情報」ページの「OAuth 2.0 クライアント ID」セクション
2. あなたのクライアント ID の名前をクリック
   - 例: 「ウェブ クライアント 1」や「Twitter Clone Web Client」

### 4-2. 承認済みの JavaScript 生成元を追加

画面を下にスクロールして「承認済みの JavaScript 生成元」セクションを探す:

**現在の状態:**
```
承認済みの JavaScript 生成元
URI がありません
```

**設定方法:**

1. **「+ URI を追加」** ボタンをクリック

2. テキストボックスが表示されるので、以下を入力:
   ```
   http://localhost:3000
   ```

3. 入力したら **Enter キー** を押すか、外側をクリック

4. URI が追加されたことを確認:
   ```
   承認済みの JavaScript 生成元
   1  http://localhost:3000  ×
   ```

### 4-3. 承認済みのリダイレクト URI を確認

同じページの「承認済みのリダイレクト URI」セクション:

**現在の状態を確認:**
- URI がない、または `http://localhost:3000` がない場合

**追加方法:**

1. **「+ URI を追加」** ボタンをクリック

2. 以下を入力:
   ```
   http://localhost:3000
   ```

3. Enter キーを押して確定

### 4-4. 変更を保存 ⚠️ 重要

ページ下部の **「保存」** ボタンをクリック

**保存を忘れると設定が反映されません！**

---

## ステップ 5: 設定内容の確認

保存後、以下のようになっているか確認:

```
クライアント ID
23293610027-d9ag06q3hkeu3cidlhbnd91vnure45o3.apps.googleusercontent.com

承認済みの JavaScript 生成元
1  http://localhost:3000

承認済みのリダイレクト URI
1  http://localhost:3000
```

---

## よくあるエラーと解決方法

### ❌ エラー 1: "承認済み JavaScript がありません"

**原因:** JavaScript 生成元が設定されていない

**解決策:**
1. OAuth クライアント ID の編集画面を開く
2. 「+ URI を追加」をクリック
3. `http://localhost:3000` を追加
4. **「保存」** をクリック ← 忘れずに！

### ❌ エラー 2: "Error 400: redirect_uri_mismatch"

**原因:** リダイレクト URI が設定されていない、または一致しない

**解決策:**
1. 承認済みのリダイレクト URI に `http://localhost:3000` を追加
2. 保存

### ❌ エラー 3: 設定を保存したのに反映されない

**原因:** ブラウザのキャッシュ、またはサーバー未再起動

**解決策:**
1. フロントエンドサーバーを再起動
   ```bash
   cd frontend
   npm run dev
   ```
2. ブラウザのキャッシュをクリア（Ctrl+Shift+Delete）
3. ページを再読み込み

### ❌ エラー 4: URI の形式が正しくない

**よくある間違い:**
- ❌ `https://localhost:3000` (https ではなく http)
- ❌ `http://localhost:3000/` (末尾のスラッシュは不要)
- ❌ `http://localhost` (ポート番号が必要)
- ❌ `localhost:3000` (http:// が必要)

**正しい形式:**
- ✅ `http://localhost:3000`

---

## 本番環境用の設定（参考）

将来、本番環境にデプロイする場合:

### 本番用 URI の追加

1. 承認済みの JavaScript 生成元に追加:
   ```
   https://yourdomain.com
   ```

2. 承認済みのリダイレクト URI に追加:
   ```
   https://yourdomain.com
   https://yourdomain.com/auth/callback
   ```

**注意:** 本番環境では `https://` を使用（http ではない）

---

## チェックリスト

設定が完了したら、以下を確認:

- [ ] 「認証情報」ページにアクセスした
- [ ] OAuth クライアント ID を開いた
- [ ] 承認済みの JavaScript 生成元に `http://localhost:3000` を追加した
- [ ] 承認済みのリダイレクト URI に `http://localhost:3000` を追加した
- [ ] **「保存」ボタンをクリックした** ⭐ 重要
- [ ] フロントエンドサーバーを再起動した
- [ ] ブラウザのキャッシュをクリアした

---

## 設定後のテスト手順

1. **バックエンドサーバーが起動していることを確認**
   ```bash
   cd backend
   npm run dev
   ```
   → `http://localhost:4000` で起動

2. **フロントエンドサーバーを再起動**
   ```bash
   # 現在のサーバーを停止 (Ctrl+C)
   cd frontend
   npm run dev
   ```
   → `http://localhost:3000` で起動

3. **ブラウザでテスト**
   - http://localhost:3000/login にアクセス
   - Google Sign-In ボタンが表示されることを確認
   - ボタンをクリック
   - Googleアカウント選択画面が表示されればOK

---

## トラブルシューティング: 画面のスクリーンショット

### 正しく設定された状態

```
┌─────────────────────────────────────────────────┐
│ ウェブ クライアントの編集                         │
├─────────────────────────────────────────────────┤
│ 名前                                             │
│ Twitter Clone Web Client                        │
│                                                  │
│ クライアント ID                                  │
│ 23293610...apps.googleusercontent.com          │
│                                                  │
│ クライアント シークレット                        │
│ GOCSPX-...                                      │
│                                                  │
│ 承認済みの JavaScript 生成元                     │
│ 1  http://localhost:3000             [×]       │
│ [+ URI を追加]                                   │
│                                                  │
│ 承認済みのリダイレクト URI                       │
│ 1  http://localhost:3000             [×]       │
│ [+ URI を追加]                                   │
│                                                  │
│                          [削除]  [保存]  [キャンセル] │
└─────────────────────────────────────────────────┘
```

---

## 次のステップ

承認済み JavaScript 生成元の設定が完了したら:

1. ✅ OAuth 同意画面の設定（完了済み）
2. ✅ OAuth クライアント ID の設定（今ここ）
3. 次: **環境変数の確認**
4. 次: **フロントエンドサーバーの再起動**
5. 次: **動作テスト**

---

## まとめ

**最も重要な3つのポイント:**

1. **URI の形式**: `http://localhost:3000`（末尾にスラッシュなし）
2. **保存を忘れない**: 設定後、必ず「保存」ボタンをクリック
3. **サーバー再起動**: 設定変更後、フロントエンドサーバーを再起動

設定が完了したら、http://localhost:3000/login でテストしてください！
