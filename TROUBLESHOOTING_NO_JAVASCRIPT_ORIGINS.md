# 「承認済みの JavaScript 生成元」が表示されない場合のトラブルシューティング

## 問題: JavaScript 生成元セクションが見つからない

「承認済みの JavaScript 生成元」セクションが表示されない主な原因は、**アプリケーションの種類が「ウェブアプリケーション」ではない**ことです。

---

## 解決方法 1: アプリケーションの種類を確認

### ステップ 1: OAuth クライアント ID のタイプを確認

1. Google Cloud Console → 「API とサービス」→ 「認証情報」
2. 「OAuth 2.0 クライアント ID」セクションを確認
3. あなたのクライアント ID の**種類**を確認:

#### 種類の見分け方:

| 表示されるタイプ | 説明 | JavaScript 生成元 |
|-----------------|------|------------------|
| **ウェブ クライアント** | ウェブアプリケーション | ✅ 表示される |
| デスクトップ クライアント | デスクトップアプリ | ❌ 表示されない |
| Android | Android アプリ | ❌ 表示されない |
| iOS | iOS アプリ | ❌ 表示されない |
| Chrome アプリ | Chrome 拡張機能 | ❌ 表示されない |

### ステップ 2: 種類の確認方法

「OAuth 2.0 クライアント ID」セクションで、以下のように表示されます:

```
┌──────────────────────────────────────────────────┐
│ OAuth 2.0 クライアント ID                         │
├──────────────────────────────────────────────────┤
│ 名前                    種類              作成日  │
│ ウェブ クライアント 1    ウェブ クライアント  ... │  ← ✅ これが正しい
│ または                                            │
│ クライアント 1          デスクトップ        ...  │  ← ❌ これは間違い
└──────────────────────────────────────────────────┘
```

---

## 解決方法 2: 新しい「ウェブアプリケーション」用 OAuth クライアント ID を作成

既存のクライアント ID が「ウェブアプリケーション」でない場合、新しく作成する必要があります。

### ステップ 1: 新しい認証情報を作成

1. 「認証情報」ページ上部の **「+ 認証情報を作成」** をクリック
2. **「OAuth クライアント ID」** を選択

### ステップ 2: アプリケーションの種類を選択

**重要: 必ず「ウェブ アプリケーション」を選択！**

1. 「アプリケーションの種類」のドロップダウンをクリック
2. **「ウェブ アプリケーション」** を選択

```
┌────────────────────────────────────┐
│ アプリケーションの種類             │
├────────────────────────────────────┤
│ ☑ ウェブ アプリケーション ← これ！ │
│ ☐ Android                          │
│ ☐ Chrome アプリ                    │
│ ☐ iOS                              │
│ ☐ デスクトップ アプリ              │
│ ☐ ユニバーサル Windows             │
│ ☐ TVs and Limited Input devices   │
└────────────────────────────────────┘
```

### ステップ 3: 名前を入力

```
名前
Twitter Clone Web Client
```

### ステップ 4: 承認済みの JavaScript 生成元を追加

「ウェブ アプリケーション」を選択すると、以下のセクションが表示されます:

#### 承認済みの JavaScript 生成元

1. **「+ URI を追加」** をクリック
2. 以下を入力:
   ```
   http://localhost:3000
   ```

#### 承認済みのリダイレクト URI

1. **「+ URI を追加」** をクリック
2. 以下を入力:
   ```
   http://localhost:3000
   ```

### ステップ 5: 作成

1. **「作成」** ボタンをクリック
2. ポップアップが表示される:
   ```
   OAuth クライアントの作成が完了しました

   クライアント ID
   23293610027-qh5ltk03q228sqe5ffn9lvmoe3k83pmh.apps.googleusercontent.com

   クライアント シークレット
   GOCSPX-xxxxxxxxxxxxx
   ```
3. **クライアント ID をコピー**
4. **「OK」** をクリック

---

## 解決方法 3: 環境変数を新しいクライアント ID に更新

新しいクライアント ID を取得したら、環境変数を更新します。

### バックエンド

`backend/.env` ファイルを編集:

```bash
# Google OAuth
GOOGLE_CLIENT_ID=23293610027-qh5ltk03q228sqe5ffn9lvmoe3k83pmh.apps.googleusercontent.com

# JWT Secret (change this in production)
JWT_SECRET=your-secret-key-change-in-production
```

### フロントエンド

`frontend/.env.local` ファイルを編集:

```bash
# Google OAuth Client ID
NEXT_PUBLIC_GOOGLE_CLIENT_ID=23293610027-qh5ltk03q228sqe5ffn9lvmoe3k83pmh.apps.googleusercontent.com
```

---

## 解決方法 4: サーバーを再起動

環境変数を更新したら、**必ず両方のサーバーを再起動**してください:

### バックエンド

```bash
# 現在実行中のバックエンドサーバーを停止 (Ctrl+C)
cd backend
npm run dev
```

### フロントエンド

```bash
# 現在実行中のフロントエンドサーバーを停止 (Ctrl+C)
cd frontend
npm run dev
```

---

## 確認方法: 「ウェブアプリケーション」として正しく作成されたか

### 方法 1: 認証情報ページで確認

```
OAuth 2.0 クライアント ID

名前                         種類                クライアント ID
Twitter Clone Web Client    ウェブ クライアント  23293610027-qh5...
                            ↑
                            これが「ウェブ クライアント」になっているか確認
```

### 方法 2: 編集画面で確認

1. OAuth クライアント ID の名前をクリック
2. 画面に以下のセクションが表示されるか確認:
   - ✅ 承認済みの JavaScript 生成元
   - ✅ 承認済みのリダイレクト URI

**これらが表示されていれば、正しく「ウェブアプリケーション」として作成されています。**

---

## よくある質問

### Q1: 既存のクライアント ID を変更できる？

**A:** いいえ。アプリケーションの種類は作成後に変更できません。新しく「ウェブアプリケーション」として作成する必要があります。

### Q2: 古いクライアント ID は削除すべき？

**A:** 使用していなければ削除しても問題ありませんが、念のため動作確認後に削除することをおすすめします。

### Q3: クライアント ID を間違えて作成してしまった

**A:** 削除して再作成できます:
1. 認証情報ページで、間違ったクライアント ID の右側の「︙」（縦の3点）をクリック
2. 「削除」を選択
3. 新しく「ウェブアプリケーション」として作成

---

## デバッグ手順

### 1. アプリケーションの種類を確認

```bash
Google Cloud Console
→ API とサービス
→ 認証情報
→ OAuth 2.0 クライアント ID セクション
→ 「種類」列を確認
```

**期待される結果:** 「ウェブ クライアント」

### 2. OAuth クライアント ID を開く

クライアント ID の名前をクリックして編集画面を開く

**以下が表示されるべき:**
- アプリケーションの種類: ウェブ アプリケーション
- 承認済みの JavaScript 生成元（このセクションが表示されるか？）
- 承認済みのリダイレクト URI

**表示されない場合:** アプリケーションの種類が「ウェブ アプリケーション」ではない

### 3. 新しいクライアント ID を作成

「+ 認証情報を作成」→「OAuth クライアント ID」→ **「ウェブ アプリケーション」** を選択

---

## チェックリスト

- [ ] Google Cloud Console → 認証情報ページを開いた
- [ ] OAuth 2.0 クライアント ID セクションで種類を確認
- [ ] 種類が「ウェブ クライアント」であることを確認
- [ ] もし違う場合、新しく「ウェブ アプリケーション」として作成
- [ ] 承認済みの JavaScript 生成元に `http://localhost:3000` を追加
- [ ] 承認済みのリダイレクト URI に `http://localhost:3000` を追加
- [ ] 新しいクライアント ID をコピー
- [ ] `backend/.env` を更新
- [ ] `frontend/.env.local` を更新
- [ ] バックエンドサーバーを再起動
- [ ] フロントエンドサーバーを再起動
- [ ] ブラウザのキャッシュをクリア
- [ ] http://localhost:3000/login でテスト

---

## まとめ

**最重要ポイント:**

1. OAuth クライアント ID の種類は **「ウェブ アプリケーション」** である必要がある
2. 「承認済みの JavaScript 生成元」は**ウェブアプリケーションでのみ表示される**
3. 種類が違う場合は、**新しく作成**する必要がある（変更不可）
4. 新しいクライアント ID で環境変数を更新し、サーバーを再起動

設定が完了したら、http://localhost:3000/login でテストしてください！
